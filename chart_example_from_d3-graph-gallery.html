<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Interactive Map</title>
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
</head>
<body style="background-color: black;"> <!-- Changed background color to black -->

<!-- Create an element where the map will take place -->
<svg id="my_dataviz" width="1350" height="830"></svg> <!-- Increased size -->

<style>
  body {
    font-family: 'Poppins', sans-serif; /* Change font to Poppins */
  }

  .tooltip {
    position: absolute;
    text-align: center;
    width: 100px;
    height: auto;
    padding: 6px;
    font: 12px 'Poppins', sans-serif; /* Change font to Poppins */
    background: white;
    border: 0px;
    border-radius: 8px;
    pointer-events: none;
    font-size: 16px; /* Increase font size */
  }

  .legend {
    font-family: 'Poppins', sans-serif; /* Change font to Poppins */
    font-size: 15px; /* Increased font size */
  }

  .legendTitle {
    font-size: 40px; /* Increased font size */
    font-weight: bold;
    text-anchor: middle;
    font-family: 'Poppins', sans-serif; /* Change font to Poppins */
    fill: white; /* White font color */
  }

  .legendRect {
    fill: url(#gradient);
  }

  .legendText {
    fill: #000;
    font-size: 14px; /* Increased font size */
    text-anchor: end; /* Align text to the end of ticks */
    font-family: 'Poppins', sans-serif; /* Change font to Poppins */
  }

  .textBesideLegend {
    font-size: 24px; /* Increased font size */
    text-anchor: middle;
    fill: white;
    font-weight: bold;
  }
</style>

<script>
// The svg
var svg = d3.select("svg"),
  width = +svg.attr("width"),
  height = +svg.attr("height");

// Map and projection
var path = d3.geoPath();
var projection = d3.geoMercator()
  .scale(180) // Adjust the scale to fit the new size
  .center([-20,40])
  .translate([width / 2, height / 2]);

// Data and color scale
var data = d3.map();
var colorScale = d3.scaleSequential(d3.interpolatePurples)
  .domain([1, 30]); // Adjusted color domain, starting from a darker purple

// Load external data and boot
d3.queue()
  .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
  .defer(d3.csv, "data.csv", function(d) { 
    data.set(d.code, +d.score); 
  })
  .await(ready);

function ready(error, topo) {
  if (error) {
    console.log(error); // Log any errors for debugging
    return;
  }

  // Log loaded data for debugging
  console.log("GeoJSON data:", topo);
  console.log("CSV data map:", data);

  let mouseOver = function(d) {
    var countryName = d.properties.name;
    var score = data.get(countryName) || 0;
    var tooltipText = `${countryName}: ${score.toFixed(0)}%`; // Remove decimals

    // Show tooltip on top of the hovered country
    tooltip.style("left", (d3.event.pageX) + "px")
      .style("top", (d3.event.pageY - 28) + "px")
      .style("opacity", 1)
      .style("font-size", "16px") // Increased font size for tooltip text
      .html(tooltipText);
  }

  let mouseLeave = function(d) {
    // Hide tooltip
    tooltip.style("opacity", 0);
  }

  // Tooltip
  var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

  // Draw the map
  svg.append("g")
    .selectAll("path")
    .data(topo.features)
    .enter()
    .append("path")
      .attr("d", d3.geoPath().projection(projection))
      .attr("fill", function (d) {
        d.total = data.get(d.properties.name) || 0; // Use d.properties.name to match the CSV code
        return colorScale(d.total);
      })
      .style("stroke", "transparent")
      .attr("class", "Country")
      .style("opacity", .8)
      .on("mouseover", mouseOver)
      .on("mouseleave", mouseLeave);

// Add legend
var legendWidth = 25, legendHeight = 750; // Adjusted height
var legendSvg = svg.append("g")
    .attr("class", "legend")
    .attr("transform", "translate(70, 50)"); // Adjusted translation

var gradient = legendSvg.append("defs")
    .append("linearGradient")
    .attr("id", "gradient")
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "0%")
    .attr("y2", "100%");

gradient.append("stop")
    .attr("offset", "0%")
    .attr("stop-color", d3.interpolatePurples(0.9)); // Reversed color scale for lighter purple

gradient.append("stop")
    .attr("offset", "100%")
    .attr("stop-color", d3.interpolatePurples(0.2)); // Reversed color scale for darker purple

legendSvg.append("rect")
    .attr("class", "legendRect")
    .attr("x", 0)
    .attr("y", 0)
    .attr("width", legendWidth) // Adjusted width
    .attr("height", legendHeight); // Adjusted height

var yScale = d3.scaleLinear()
    .domain([0, 30]) // Adjusted domain
    .range([legendHeight, 0]); // Reversed range

var yAxis = d3.axisLeft(yScale)
    .ticks(6)
    .tickSize(10)
    .tickFormat(d => d.toFixed(0) + "%"); // Remove decimals and format

legendSvg.append("g")
    .attr("class", "y axis")
    .call(yAxis)
    .selectAll("text")
    .attr("class", "legendText")
    .attr("x", -5) // Adjusted x position for labels
    .style("text-anchor", "end")
    .attr("dy", "0.35em")
    .style("font-size", "14px") // Increased font size for legend text
    .style("fill", "white"); // White font color


  // Add text beside legend
  svg.append("text")
    .attr("class", "textBesideLegend")
    .attr("x", legendWidth + 430) // Adjusted x position
    .attr("y", 50) // Adjusted y position
    .attr("text-anchor", "middle")
    .attr("alignment-baseline", "hanging")
    .text("Average % of a woman's day")
    .style("font-size", "50px") // Increased font size
    .style("fill", "white") // White font color
    .style("font-weight", "bold"); // Bold font

  svg.append("text")
    .attr("class", "textBesideLegend")
    .attr("x", legendWidth + 430) // Adjusted x position
    .attr("y", 100) // Adjusted y position
    .attr("text-anchor", "middle")
    .attr("alignment-baseline", "hanging")
    .text("spent on unpaid care work")
    .style("font-size", "50px") // Increased font size
    .style("fill", "white") // White font color
    .style("font-weight", "bold"); // Bold font
}
</script>
</body>
</html>
